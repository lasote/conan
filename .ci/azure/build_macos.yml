# File: jobs/build.yml

parameters:
  pyver: ''

jobs:
- job: ${{ format('Macos{0}', parameters.pyver) }}
  timeoutInMinutes: 0
  cancelTimeoutInMinutes: 0
  variables:
    pyver: ${{ parameters.pyver }}
  pool:
    vmImage: 'xcode9-macos10.13'
  steps:
  - task: UsePythonVersion@0
    inputs:
      ${{ if eq(parameters.pyver, 'py37') }}:
        versionSpec: '3.7.0'
      ${{ if eq(parameters.pyver, 'py36') }}:
        versionSpec: '3.6'
      ${{ if eq(parameters.pyver, 'py34') }}:
        versionSpec: '3.4.8'
      ${{ if eq(parameters.pyver, 'py27') }}:
        versionSpec: '2.7.15'
      addToPath: true
      architecture: 'x64'
  - script: sudo pip install virtualenv
  - script: brew install pkg-config
  - script: |
      python $(runner) $(module) $(pyver) $(sourcedir) $(workdir) -e rest_api --num_cores=$(num_cores) --server_api=$(api_conf) -f $(flavor)
      cat $(sourcedir)/setup.json
      cat $(sourcedir)/tests.json
    displayName: Regular tests
    env:
      CONAN_RECIPE_LINTER: 'False'
      CONAN_TEST_FOLDER: $(workdir)
      CONAN_LOGGING_LEVEL: 1
